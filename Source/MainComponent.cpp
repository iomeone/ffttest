#include "MainComponent.h"

//==============================================================================

double TWOPI = juce::MathConstants<double>::twoPi;

double hpi = juce::MathConstants<double>::halfPi;


double curtime = 0;

double dt = TWOPI /(float) fftSize ;
const int bufsize = 474;

//1,https://danmarshall.github.io/google-font-to-svg-path/
//2,https://shinao.github.io/PathToPoints/
//




// 108
float bufx[bufsize] = {
29.704296874999997,
32.58129150390625,
35.40243987266098,
38.01948417053923,
40.165403228759764,
41.35855712890625,
40.9265625,
38.33400421142578,
35.64256902798461,
33.68350830078124,
31.91963424682617,
29.988677215576168,
29.7,
29.7,
29.699999999999996,
29.7,
29.7,
29.7,
29.699999999999996,
29.736499023437496,
29.799999999999997,
29.8,
29.590251831054687,
28.91076542407295,
26.668994384765625,
24.506541015625,
22.876666259765624,
21.480517578125003,
21.648001409054896,
24.041796875000003,
24.23981590270996,
24.301195338275285,
24.3626953125,
24.424263154435906,
24.485911364108325,
24.547295660525563,
24.365602111816408,
22.619532775878906,
20.696626975194903,
18.612039884758083,
16.34197838976623,
13.912531471252441,
11.327469635009766,
8.612843624434317,
5.729967031663583,
2.7668994140625003,
0.11551513671875001,
2.904497528076172,
5.5588836669921875,
8.072098218290515,
10.452471397747214,
12.704340831529306,
14.799261299112521,
16.716461061147946,
18.439937395751784,
19.99653857421875,
21.370935098414627,
22.56147625732422,
23.6375,
24.12088623046875,
21.23200378417969,
18.304464721679686,
15.323371124267577,
12.379666900634763,
9.64390869140625,
7.469472473144531,
8.458787522187938,
11.45330810546875,
14.44898681640625,
17.445645141601563,
20.432861328124996,
23.37750549316406,
24.65146484375,
24.53720550537109,
24.389062499999998,
24.224999999999998,
24.0625,
23.64364086914063,
22.25002734375,
24.193986834151342,
27.120409091054785,
29.807472203226318,
31.280480957031248,
30.736355590820313,
30.031623460100057,
29.809889160156253,
29.799999999999997,
29.912890625000003,
32.779506423538315,
35.68880821031959,
38.681982421875,
41.40532264539184,
43.437835937500004,
41.949169921875004,
38.960146484375,
35.96768432405145,
32.98054394408636,
30.020998219263426,
29.75750732421875,
29.70088195800781,
124.3,
124.30000000000001,
124.29999999999998,
124.3,
124.3,
124.29999999999998,
124.3,
125.76624194335936,
127.59558780511733,
129.1239048461914,
130.71341214730109,
133.34821044921873,
135.4484541647082,
135.5247858428955,
134.04461198425292,
131.91261010742187,
129.30406184890128,
126.50057678222655,
124.3,
124.33594360351563,
127.30638580322264,
130.2892034814715,
133.2708145343814,
133.94946875,
131.73489990234373,
128.86873364257812,
125.88501779174806,
124.3,
124.30000000000001,
124.31245117187501,
124.48883450579935,
125.11874999999999,
125.5798583984375,
124.22240219116209,
121.57189061400963,
118.63068750000001,
117.11673583984376,
118.209447265625,
118.51653624913327,
118.68952724189805,
118.82677817617858,
118.93465576171874,
119.02808151245117,
118.77238170608526,
115.82220929996258,
112.85154055550893,
109.87299609374999,
106.8783447265625,
103.87900390624999,
104.33798611339131,
106.68646145381202,
109.521650390625,
112.4357444897294,
115.34316560029984,
115.76391562527935,
114.76451049873407,
113.55886128077626,
112.18922061920166,
110.65904312133789,
108.97865203157505,
107.14936421548833,
105.16167455381895,
102.99969566345214,
100.5990146484375,
100.33829345703126,
103.27499999999998,
106.05390014648438,
108.57453536987303,
110.86943054199219,
112.90162200927733,
114.74052734375,
116.38421655836636,
117.87266116468757,
119.09993553161621,
119.08897552490234,
119.0589599609375,
119.00989837646485,
118.94882812499999,
118.888671875,
118.82968749999999,
118.41899414062499,
115.772921875,
115.51176757812499,
117.0088653564453,
118.64837341308592,
120.74840150003826,
123.0390861299647,
124.15183966064453,
124.4,
124.4,
124.34375,
178.96383924484252,
178.7307717323303,
178.7702209472656,
178.81543588638306,
178.86724586486815,
178.92568969726562,
178.9914524078369,
179.0542402801514,
179.0981731414795,
179.1240254020691,
179.1329817352295,
179.12592605592332,
179.10373997011072,
178.78422241210936,
177.75687912770832,
175.54261065352048,
172.69787499999998,
170.64531021118165,
168.59617691040037,
166.47100467681884,
164.01384658813475,
161.28181549689523,
162.56862158203126,
165.5777510201665,
168.57498144531252,
171.53196484375,
172.81892641984507,
173.10000000000002,
173.1,
173.1,
173.1,
173.10000000000002,
173.09921875,
173.0799774169922,
173.035595703125,
173.00564270019532,
172.07181396484373,
169.14069442749025,
166.24189071655272,
163.32478515625,
160.63278773611984,
158.55862426757815,
159.59661490463031,
162.58009435338843,
165.57499267578126,
168.56180419921878,
171.5157684326172,
172.89311447143555,
172.84806594848632,
172.80770587921143,
172.73656311335174,
172.28265307617187,
171.43191293031816,
170.36891811334192,
171.6125,
174.5732260855406,
177.37749894158304,
179.66961034778566,
179.91117248535156,
178.9358203125,
178.73479156494142,
178.7,
178.7,
180.06663658881456,
183.0163532748797,
185.99511376341718,
188.6239418252221,
190.35470223322767,
189.70763305664062,
186.71825185800904,
183.734228515625,
52.6,
52.6,
52.599999999999994,
52.6,
53.93125083595515,
56.88462029809947,
59.82987060546875,
62.772640991210935,
65.72043684365954,
68.6919677734375,
71.49880371093751,
73.3810546875,
70.62810974121092,
67.68079833984375,
64.71002655029297,
61.729985046386716,
58.73343505859375,
55.74563827514649,
52.772613525390625,
52.65307124555111,
52.709654581174256,
52.76629888527095,
53.98749999999999,
56.93474764206661,
59.893820190429686,
62.82910995483398,
65.78029174804688,
68.76970214843749,
71.57474885802293,
73.30622265679554,
70.52006738281248,
67.5545113607873,
64.59440307617187,
61.604901123046865,
58.60864486694336,
55.623617553710936,
52.79998916330451,
52.819366718600605,
52.876322946225,
52.95380249023437,
52.99571380615234,
54.7031678413669,
57.664003906249995,
60.610620747787294,
63.58821960199022,
66.59566528320312,
69.59088439941407,
72.58246154785155,
75.11488623046874,
75.29749908447265,
75.43087310791016,
75.57244911193848,
75.71981163024903,
75.86296234130862,
75.99533958435059,
76.1154842376709,
76.22348556518556,
76.31128463745118,
76.37158126831056,
76.39901123046876,
76.37004206848144,
76.19208869934081,
74.93487650419499,
71.94531249999999,
68.95468749999999,
65.97074813842772,
62.979589843750006,
60.01293334960937,
57.06222229003906,
54.11239318847656,
46.083687499999996,
44.00199334301427,
45.43998701666029,
48.41943969726562,
51.15703125,
53.52945556640625,
56.491592300415036,
59.45616670483796,
62.42095619776824,
65.3854433081961,
68.34976920819018,
71.31737109375,
73.94396057128907,
76.6062066040039,
79.39472472437531,
81.86725387573243,
83.91347675703715,
84.78423118081032,
83.55378970029459,
82.62421796266788,
82.46352205276489,
82.30479249954224,
82.13282625198364,
81.94898071289062,
81.78392486572265,
81.64415969848633,
81.53032531738282,
81.43840408325195,
81.36380249023438,
81.30165757751466,
81.24664373397827,
81.19849613189129,
81.07723770141601,
80.8384765625,
80.44176940917968,
79.71249999999999,
77.26538791038516,
75.50980644226074,
74.19518127441407,
72.67274169921873,
69.66430078125,
66.67631676096273,
63.671667480468756,
60.684199523925784,
57.69800567626953,
54.728903198242186,
52.982175846499885,
52.21769018554687,
49.75375,
47.959671020507805,
46.26484375,
45.95074234008789,
46.77684020996094,
47.0009765625,
47.027431640625,
47.072265625,
47.11640625,
47.1572021484375,
47.174935531616214,
47.162084960937506,
47.126171875,
47.08749999999999,
47.04739646911621,
46.98526878356933,
46.87724609375,
46.7113720703125,
146.60603713989258,
147.37468359374998,
148.05624999999998,
148.77832470703123,
148.879703125,
145.95143432617186,
143.06292114257815,
140.20178451538084,
137.33144531250002,
134.84033203124997,
134.21857802160656,
137.16338272094728,
140.15694580078122,
143.13072509765624,
146.03526611328124,
148.8147131347656,
151.3023203125,
154.12543334960938,
156.49091644878598,
157.88276706848742,
156.078076171875,
154.91952469475757,
153.8326171875,
152.8878143310547,
152.07223815917968,
151.0498046875,
153.0081861015338,
154.98989869773692,
156.65410690307615,
157.73615036010742,
158.17100244140624,
157.17118935219057,
154.51122290039064,
152.44249801635743,
150.66407470703126,
149.12716064453127,
147.5889214964649,
145.89674982045005,
143.98804570214602,
141.85151367187498,
139.49296875,
136.8936261816461,
134.0897975428587,
131.15598680886652,
128.15780907303562,
126.97410583496094,
129.80330505371091,
132.48959102630613,
134.98730697631834,
137.25098018646239,
139.2815237045288,
141.0791046142578,
142.67762145996093,
144.08437499999997,
143.49065895080565,
141.56401405334472,
139.55571899414062,
137.47767677307127,
137.28116577148438,
140.13076177978516,
142.72673028813716,
145.205286077634,
161.156604309082,
163.85388592727006,
166.1903275553309,
168.07215210402336,
169.4281671679201,
169.6684680175781,
168.53515625,
165.77380810546876,
163.7802352294922,
161.40703125,
158.51113702196588,
160.77343750000003,
160.776220703125,
159.91354242782495,
};


// 108
float bufy[bufsize] = {
                               30.117,
                           30.939989501953125,
                           31.937339013965634,
                           33.41470232642607,
                            35.475797256469725,
                           38.206691650390624,
                    41.12090625,
                           42.0562998046875,
                           40.807212239509525,
                           38.53800830078125,
                           36.12172183227539,
                            33.828069488525394,
              36.08812963795662,
              39.09450746607781,
                            42.10421366301179,
              45.10068434058502,
              48.10178583162651,
              51.10051496858522,
                            54.0893268687725,
                            57.08681201171874,
                            60.09158534240723,
              63.10051402282715,
                            66.08388891601562,
                           68.98433899916714,
                            70.62034509277345,
                         68.635453125,
                            66.10371875,
                            63.4642900390625,
                            60.98918282588017,
                            59.36465625,
                           56.375974742889404,
                            53.383727259079926,
                       50.385603515625,
                            47.38417122124974,
                            44.378820999719196,
                            41.38633654937893,
                            39.17961978149414,
                            41.60946597290039,
                            43.927058863544694,
                            46.06875877135921,
                           48.03349810385608,
                            49.790664283752434,
                            51.316735260009764,
                           52.56633132952524,
                           53.41927435477943,
                            53.79818554687499,
                             53.17616748046875,
                           52.03330783081054,
                            50.63621081542969,
                           49.002087487992895,
                            47.19083121372165,
                            45.20617812878125,
                            43.0585584599586,
                            40.751542687168104,
                            38.28950909084795,
                           35.74451831054687,
                            33.06355614010888,
                           30.31433294677734,
                 27.516999999999996,
                           25.357625,
                           26.1935625,
                            26.84901904296875,
                            27.11500338745117,
                            26.5723596496582,
                          25.34503955078125,
                           23.320389221191405,
                           21.65069953733733,
                           21.7908037109375,
                           21.7279375,
                            21.59856433105469,
                            21.261873046874996,
                           20.782939331054685,
                        18.861677734375,
                           15.854551116943357,
                            12.867353240966796,
                            9.8636796875,
                 6.872029296875,
                           3.9114716796875,
                        1.27519921875,
                            0.028420328246771234,
                            0.6739477471609852,
                            1.9867056823323557,
                            4.404060546874999,
                            7.363667480468749,
                            10.270746411000852,
                            13.25952880859375,
                            16.261074849784375,
                            19.035750000000004,
                            18.144056007705007,
                           17.48234601353507,
                         17.56613330078125,
                           18.754143091573837,
                            20.927974609375,
                            22.7829423828125,
                         22.92106494140625,
                           23.05218599591203,
                           23.365764324364005,
                            23.84925907107318,
                           26.682625,
                           29.66896533203125,
               52.04772232455015,
                            49.04849757739156,
                            46.06087738176156,
               43.063133633144204,
               40.056453125,
                            37.05155082084983,
               34.05019421261549,
                            35.04285546875,
                            37.41623282506578,
                           39.98361682128906,
                            42.51892469570209,
                            43.84470532226562,
                           42.04287604239617,
                           39.08137342834473,
                            36.50224967956542,
                            34.40853198242188,
                            32.93730683561648,
                            31.85609606933594,
               30.58599906396866,
                            27.61075915527344,
                            27.16368807983398,
                           26.84548638298081,
                           26.651506466744937,
                      24.842050781250002,
                            22.86553515625,
                            22.0418466796875,
                            22.33207208251953,
               21.354330263853075,
                            18.344268265932797,
                            15.336866943359373,
                            12.355261150773813,
                            9.42559375,
                           6.4589036865234375,
                            3.971676055908203,
                            2.6075684373247503,
                            2.012375,
                            3.6056108398437496,
                          6.392537109375,
                            9.363227973315835,
                            12.370693814622776,
                            15.363135427781554,
                            18.36728076171875,
                            21.35523776245117,
                            24.092593623224044,
                            24.671984596434683,
                            25.086432844890158,
                            25.3857890625,
                           25.487089721679684,
                            25.51689013671875,
                            28.068698970071736,
                            29.909631148888373,
                          30.7730634765625,
                           30.09839822483063,
                            29.360005561828615,
                            31.06004324159113,
                            33.90124750295426,
                            36.64856480536402,
                            39.30399016571045,
                            41.88618869018555,
                            44.36853659774061,
                            46.740679688884455,
                            48.9909249736655,
                            51.072851898193356,
                           52.87988085937501,
                            53.971577636718756,
                            53.648250000000004,
                            52.50936602783203,
                            50.89622515869141,
                            48.94601000976562,
                            46.75123919677734,
                         44.377839843749996,
                            41.87688034118171,
                            39.27273970976934,
                            37.065795890808104,
                            40.065394012451165,
                           43.07460498046874,
                            46.074292938232425,
                            49.07174834442139,
                       52.07486113739013,
                            55.08096179199218,
                            57.98911914062499,
                       59.295912109375,
                            61.63754443359375,
                           64.23184375,
                            66.75373400878907,
                            68.8168777955474,
                           67.32269620744606,
                            64.55307739257812,
               61.56389998030663,
               58.573992721557616,
                   55.563874999999996,
                            26.494057456970214,
                           29.250581256866454,
                           32.264882080078124,
                            35.257556812286374,
                            38.26127986145019,
                            41.25472583007812,
                           44.251257888793944,
                           47.252308425903315,
                           50.256299392700186,
                           53.24917232131958,
                           56.250834548950195,
                            59.262456371920905,
                            62.25238278077357,
                            65.23890780639648,
                            68.02932951124015,
                            69.97938747816336,
                            69.57757006835936,
                            67.39405841064453,
                            65.19950274658203,
                            63.10035494995117,
                            61.38179187011718,
                            60.17587044452938,
                            59.0705986328125,
                           59.21964684705269,
                            59.278720947265626,
                         58.941191894531244,
                            56.36245250652626,
                            53.36719073486328,
               50.37898165416718,
               47.36747225058079,
               44.37910000365972,
                            41.37214251738787,
                      38.36934375,
                           35.380192749023436,
                          32.370271484375,
                            29.371598999023433,
                            27.48568896484375,
                            28.11941317749023,
                            28.878241714477536,
                         29.16205737304687,
                            27.862484193695078,
                            25.732612792968748,
                            23.91247481613452,
                            23.8674300305897,
                            23.70386279296875,
                            23.325679199218747,
                           22.86558093261719,
                            21.017093078613282,
                            18.02305926513672,
                            15.016894332885743,
                            12.02912920714947,
                            9.048421386718749,
                            6.182292454543729,
                            3.374822127240885,
                  1.7236467285156252,
                           2.1609605572889574,
                            3.2340159303459495,
                            5.117402344008269,
                            8.003172485351563,
                        10.83502734375,
                            13.816166870117186,
               16.833180419921874,
               19.825794403076173,
                            21.08847902486555,
                           20.49807222974784,
                            20.58821798152509,
                           21.92982738595063,
                            24.352401440730223,
                            26.77497680664063,
                            26.727753078968977,
                          26.376375,
              17.369367973327638,
              20.366423275887968,
                            23.361364643096923,
              26.370368542157113,
                           27.778057542264463,
                           27.2633658249568,
                           26.728868286132812,
                            26.112315551757817,
                           25.503049136839692,
                          25.43662890625,
                           26.439142578125,
                       28.579109375,
                           29.613875,
                           30.12325,
                           30.536713592529296,
                            30.89261569213867,
                           31.19918994140625,
                           31.445580474853514,
                            31.266346923828124,
                           34.02977601420879,
                            37.02869280223548,
                           40.030840919360514,
                           41.597126953125,
                           41.056093827795216,
                            40.51532229614257,
                           39.90066851806641,
                           39.356758300781244,
                           39.35069140625,
                           40.38187698266163,
                           42.50305886994736,
                           43.508744140625,
                          44.042000442824026,
                           44.44228686523438,
                            44.764698974609374,
                           45.04434375,
                            45.327937500000004,
                           45.249577865903944,
                            48.24570802627973,
                         51.24134901794615,
                           54.254084960937504,
                           57.25766772460938,
                          58.20353927211357,
                            57.679039062499996,
                            57.18884801867958,
                           56.82036825653206,
                           56.646977050781246,
                           56.62828540039061,
                           56.821400634765624,
                           55.99686279296875,
                           52.99997882080078,
                           50.01411456298828,
                           47.011856643676765,
                           44.018893234252936,
                           41.019519226074216,
                           38.01262187194824,
                          35.0225004119873,
                           32.03061484527588,
                           29.026700965881346,
                           26.02186240386963,
                           23.02609729003906,
                           20.018555587768557,
                           17.03657145690918,
                           14.582083879893064,
                           14.482162658691406,
                           14.703061096191407,
                           15.004013244628906,
                            15.368611328125,
                           15.818541137695311,
                           16.330970947265627,
                           16.850258056640623,
                            13.716562499999998,
                           11.5743985947514,
                           9.917074289630364,
                           10.25275439453125,
                     11.409968749999999,
                           12.5152177734375,
                            11.973109374999998,
                           11.512567658401696,
                           11.054643123664727,
                          10.589767353751757,
                           10.165194407177777,
                        9.698,
                           8.271617309570313,
                          7.091008117675781,
                           8.140906389978616,
                           9.829332916259766,
                           12.023092849759413,
                           14.81274311879707,
                           17.513148124450105,
                           20.342607110997523,
                           23.331385509490968,
                           26.320326488494874,
                           29.321874279022214,
                           32.3156083984375,
                           35.30356616210937,
                           38.30586260986328,
                           41.31009692382813,
                           44.29674395751953,
                           47.313111328125004,
                           50.304008911132804,
                           53.30318899536133,
                           56.3025134249581,
                           59.301090423583986,
                       62.2972734375,
                           65.26382006835937,
                           68.161796875,
                           68.81869775323102,
                           66.43661288452147,
                           63.745802490234375,
                           61.55675830078125,
                        61.425458984375,
                           61.428812428312106,
                            61.5158525390625,
                            61.7360689086914,
                           62.061154357910155,
                            62.509276000976556,
                            64.15206646518183,
                           67.03183447265624,
                  67.32099609375,
                            64.91621875,
                     62.4560625,
                           59.59891680908203,
                           56.70927294921875,
                       53.735452148437496,
                         50.72235522460937,
                      47.73699893188477,
                     44.740867797851564,
                          41.73704394531249,
                            38.73731440734862,
                            35.7360673828125,
                      32.72778338623047,
                           29.734187499999997,
                           26.729528419494635,
                           23.73726462554932,
                        20.744587890625002,
                          17.73512768554687,
                            32.55647372436523,
                            29.6687265625,
                            26.74806689453125,
                            23.840074218749997,
                       21.192582031249998,
                            21.818522827148435,
                            22.60812548828125,
                            23.551449005126955,
                            23.438630859375003,
                            21.8121171875,
                            19.133042993361066,
                            18.99255465698242,
                            18.883369628906248,
                            18.54806689453125,
                            17.81132373046875,
                           16.70733837890625,
                        15.042708984375,
                            15.652852050781249,
                            17.494394082349736,
                            20.05163055738325,
                          22.369197265625,
                            25.137012164252084,
                        27.9295,
                           30.781062499999997,
                            33.663875,
                        36.492,
                           38.6468058336548,
                            40.8905256773568,
                            43.38140734863281,
                            46.17881335449219,
                            49.1306396484375,
                            51.87038661270847,
                            51.32179016113281,
                            49.153157989501956,
                            46.72598132324219,
                            44.1689287109375,
                           43.639261971559804,
                            46.12263104869478,
                            48.439620610753465,
                            50.54326953124999,
                      52.3810625,
                           53.877349761576845,
                           54.944499733587236,
                            55.493651183398306,
                            55.38690681016671,
                            54.43663195800781,
                            53.4507921142578,
                            52.118490974426265,
                            50.452565948486324,
                            48.49738501739502,
                           46.28576850128174,
                           43.89585131835938,
                            41.35742358398437,
                            38.71074999999999,
                            36.20971965026855,
                            33.91750468444824,
                            31.685572998046872,
                            29.50539225769043,
                            27.891958984375,
                            28.761252014160156,
                            30.26167441688973,
                          31.947083519554763,
                          32.88149890136719,
                            34.16879762643405,
                           36.05940736417808,
                            38.36433659070578,
                           41.049605877062234,
                           44.01350775146485,
                      46.74078540039062,
                            47.2065591430664,
                           45.006255752563476,
                      43.34025439453124,
                            42.66685346870742,
                            40.9045,
                          38.142,
                            35.27208325303998
};



float datax[fftSize * 2] = { 0 };
float datay[fftSize * 2] = { 0 };



MainComponent::MainComponent() : fft(fftOrder)
{
    setSize (1920, 1080);
  

    //for (int p = 0; p < bufsize; p++)
    //{
    //    bufx[p] = bufx[p] - 300.0;
    //    //bufy[p] = bufy[p] * 2.0;
    //}


    for (int i = 0; i < bufsize; i++)
    {
        datax[i] = bufx[i];
        datay[i] = bufy[i];
    }

    for (int i = bufsize; i < fftSize; i++)
    {
        datax[i] = bufx[bufsize-1];
        datay[i] = bufy[bufsize-1];
    }


    fft.performRealOnlyForwardTransform(datax, false);
    fft.performRealOnlyForwardTransform(datay, false);

    //juce::Thread::sleep(5000);
    //juce::AlertWindow::showOkCancelBox(juce::MessageBoxIconType::WarningIcon, "", "", "ok", "no", nullptr, nullptr);
    startTimer(1000.f/ fftSize * 5.0);


}

MainComponent::~MainComponent()
{
}

//==============================================================================
//#include "stdio.h"
double distance(juce::Point<double> p1, juce::Point<double> p2)
{
    auto x = p1.x - p2.x;
    auto y = p1.y - p2.y;
    return sqrt( x*x + y*y);


}

void MainComponent::paint (juce::Graphics& g)
{
    //if (needPaint)
    //{
    //    needPaint = 0;
    //}
    //else
    //    return;
    // (Our component is opaque, so we must completely fill the background with a solid colour)

    g.fillAll(juce::Colours::lightcyan);
    g.setColour(juce::Colours::darkturquoise);
 


    //g.setFont (juce::Font (16.0f));

    //g.drawText ("Hello World!", getLocalBounds(), juce::Justification::centred, true);

       /*    */
    //for (int p = 0; p < bufsize; p++)
    //{
    //    //g.drawLine(juce::Line<float>(bufx[p], bufy[p], bufx[p + 1], bufy[p+1] ), 3);
    //    float radi = 3;

    //    g.drawRect(bufx[p], bufy[p], radi, radi, 2.0);

    //}


    //juce::Path path;
    //path.startNewSubPath(juce::Point<float>(bufx[0], bufy[0]));
    //for (int p = 1; p < bufsize; p++)
    //{
    //    path.lineTo(juce::Point<float>(bufx[p], bufy[p]));

    //}
    //path.closeSubPath();
    //g.fillPath(path);
    //return;

    double finalx = getWidth() / 5.0f * 3.0;
    double finaly = getHeight() / 5.0f * 3.0;
    
    juce::Path _finalpath;
    //_finalpath.startNewSubPath(juce::Point<float>(finalx, finaly));

    //float prefinalx = finalx;
    //float prefinaly = finaly;



    double x_left = getWidth() / 5.0f;
    double y_left = getHeight() / 5.0f * 2.0;

    double radiusLeft = 0.0;
    double radiusRight = 0.0;

    double prevx_left = 0;
    double prevy_left = 0;
    {


        for (int i = 0; i < fftSize; i++)
        {
            prevx_left = x_left;
            prevy_left = y_left;

            double re_left = datax[i * 2] / fftSize;
            double im_left = datax[i * 2 + 1] / fftSize;

            double freq = i;
            double amp = sqrt(re_left * re_left + im_left * im_left);
            double phase = atan2(re_left, im_left);
            double radius = amp;

            x_left += radius * cos(freq * curtime + phase);
            y_left += radius * sin(freq * curtime + phase);
            
            if (i > 0)
            {
                juce::Line<float> l(prevy_left,  prevx_left + 200,   y_left, x_left + 200);
                g.drawArrow(l, 1, 15,15);
                //g.drawLine(prevx_left, prevy_left, x_left, y_left);
                g.drawEllipse(prevy_left - radius,  prevx_left - radius + 200,  radius * 2, radius * 2, 1);
            }

        }

        finalx = y_left;
    }

 


    double x_right = getWidth() / 5.0f * 4.0;
    double y_right = getHeight() / 5.0f;
    double prevx_right = 0;
    double prevy_right = 0;
    {


        for (int i = 0; i < fftSize; i++)
        {
            prevx_right = x_right;
            prevy_right = y_right;

            double re_left = datay[i * 2] / fftSize;
            double im_left = datay[i * 2 + 1] / fftSize;

            double freq = i;
            double amp = sqrt(re_left * re_left + im_left * im_left);
            double phase = atan2(re_left, im_left);
            double radius = amp;

            x_right += radius * cos(freq * curtime + phase );
            y_right += radius * sin(freq * curtime + phase );
            
            if (i  > 0)
            {
                juce::Line<float> l(prevx_right, prevy_right, x_right, y_right);
                g.drawArrow(l, 1, 15, 15);
                //g.drawLine(prevx_right, prevy_right, x_right, y_right);
                //g.drawEllipse(prevx_right - radius, prevy_right - radius, radius * 2, radius * 2, 1);

                g.drawEllipse(prevx_right - radius , prevy_right - radius , radius * 2, radius * 2, 1);
             }

        }

        finaly = y_right;
    }
   

    g.setColour(juce::Colours::darkmagenta);

    
    _points.push_back({ finalx , finaly });
   
    int index = 0;

    juce::Point<double> oldP = { 0.f, 0.f };

    juce::Point<double> startPoint = { 0.f, 0.f };
    for (auto p : _points)
    {

        auto dis = distance(oldP, p);
        if (dis < 40)
        {
            g.drawLine( oldP.x, oldP.y, p.x, p.y, 3);

        }
        else
        {
            //int a = dis;

            //auto dis2 = distance(startPoint, p);
            //if (dis2 < 40)
            //{
            //    g.drawLine(oldP.x, oldP.y, startPoint.x, startPoint.y, 3);
            //}

            g.drawRect((float)p.x, (float)p.y, (float)3, (float)3, 4.0);
            //startPoint = p;

        }
        oldP = p;
        //if (index == 0)
        //{
        //    _finalpath.startNewSubPath(p /*/ fftSize*/);
        //    index++;
        //}
        //else
        //{
        //    _finalpath.lineTo(p /*/ fftSize*/);
        //    index++;
        //}
        double radi = 3;

        //g.drawRect((float)p.x, (float)p.y, (float)radi, (float)radi, 4.0);
    }



    {
        juce::Line<float> lf(y_left, x_left + 200, finalx, finaly);
        g.drawLine(lf);
    }


    {
        juce::Line<float> lf(x_right, y_right, finalx, finaly);
        g.drawLine(lf);
    }

    //_finalpath.closeSubPath();
    //juce::PathStrokeType stroketype(2);
    //g.strokePath(_finalpath, stroketype);

   
}

void MainComponent::resized()
{
    // This is called when the MainComponent is resized.
    // If you add any child components, this is where you should
    // update their positions.
}


void MainComponent::timerCallback()
{
    //static int64_t i = 0;
    //i++;
    //if(i%3 == 0)
    //{
    //if (needPaint == 0)
    //{
    //    curtime += dt;

    //    needPaint = 1;
   
    //}

    //repaint();

    //}

    curtime += dt;
    needPaint = 1;
    repaint();
}
